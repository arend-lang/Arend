\open ::LC::Term::Term
\open ::LC::Util::Ctx
\open ::LC::Util::RVec

\open ::Data::Empty
\open ::Data::Nat::Base
\open ::Data::Fin
\open ::Paths


-- Quotient term properties

\function
gamma
    {n : Nat}
    (env : Ctx n)
    (t : QTerm env) : ITerm n <= \elim t
        | QVar i            => IVar i
        | QApp t1 t2        => IApp (gamma env t1) (gamma env t2)
        | QLam x t          => ILam (gamma (extend env x) t)
        | trunc t1 t2 pr i  => gamma-respects-alpha-eq env t1 env t2 pr @ i 


\function
gamma-respects-alpha-eq
    {n : Nat}
    (env1 : Ctx n)
    (t1 : QTerm env1)
    (env2 : Ctx n)
    (t2 : QTerm env2)
    (proof : AlphaEq' env1 t1 env2 t2) : gamma env1 t1 = gamma env2 t2 <= \elim t1, t2, proof
        | QVar i, QVar j, QVarEq p              => pmap IVar p
        | QApp t1 s1, QApp t2 s2, QAppEq p q    =>  \let
                                                        | rec1 => gamma-respects-alpha-eq env1 t1 env2 t2 p
                                                        | rec2 => gamma-respects-alpha-eq env1 s1 env2 s2 q 
                                                    \in pmap2 IApp rec1 rec2 
        | QLam x t1, QLam y t2, QLamEq p        =>  \let 
                                                        | rec => gamma-respects-alpha-eq (extend env1 x) t1 (extend env2 y) t2 p
                                                    \in pmap ILam rec
        | trunc t1 t2 p1 i, trunc t3 t4 p2 j, _ =>  \let
                                                        | rec1 => gamma-respects-alpha-eq env1 t1 env1 t2 p1
                                                        | rec2 => gamma-respects-alpha-eq env2 t3 env2 t4 p2
                                                        {-| psq1 => psqueeze rec1 i
                                                        | psq2 => psqueeze rec2 j
                                                        | pr => gamma-respects-alpha-eq env1 t1 env2 t3 {?}-}
                                                    \in path (\lam i => {?}) --(inv psq1) *> pr *> psq2

